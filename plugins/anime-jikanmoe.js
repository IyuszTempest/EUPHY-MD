/** * Plugin Jikan Moe (Anime Search)
 * Style: Euphylia Magenta - Ultimate UI
 */

const axios = require('axios');

module.exports = {
    command: ['jikanmoe', 'anime'],
    category: 'anime',
    noPrefix: true, 
    call: async (conn, m, { text, command, usedPrefix }) => {
        if (!text) return m.reply(`Mau cari anime apa hari ini? ğŸŒ¸\nContoh: *${usedPrefix + command} tenten kakumei*`);

        // Reaksi loading biar estetik
        await conn.sendMessage(m.chat, { react: { text: 'ğŸ”', key: m.key } });

        try {
            // Memanggil API IyuszTempest
            const apiEndpoint = `https://iyusztempest.my.id/api/anime?feature=jikanmoe&query=${encodeURIComponent(text)}&apikey=${global.apiyus}`;
            const response = await axios.get(apiEndpoint);
            
            if (response.data.status !== "success" || !response.data.data.length) {
                return m.reply('Aduh, Euphy nggak nemu info animenya. Coba cek judulnya lagi ya! ğŸ®');
            }

            // Ambil hasil pertama yang paling relevan
            const data = response.data.data[0];
            
            let caption = `â•­â”â”ã€” â›©ï¸ *ANIME INFORMATION* â›©ï¸ ã€•â”â”â”“\n`
            caption += `â”ƒ ğŸ® *Judul:* ${data.title}\n`
            caption += `â”ƒ ğŸ‡¯ğŸ‡µ *Japanese:* ${data.title_japanese || 'N/A'}\n`
            caption += `â”ƒ â­ *Score:* ${data.score || 'N/A'}\n`
            caption += `â”ƒ ğŸï¸ *Type:* ${data.type}\n`
            caption += `â”ƒ ğŸ“… *Status:* ${data.status}\n`
            caption += `â”ƒ ğŸ”¢ *Episodes:* ${data.episodes || 'Unknown'}\n`
            caption += `â”ƒ ğŸ•’ *Duration:* ${data.duration}\n`
            caption += `â”ƒ ğŸ” *Rating:* ${data.rating}\n`
            caption += `â”ƒ ğŸ”— *MAL URL:* ${data.url}\n`
            caption += `â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›\n\n`
            caption += `ğŸ“– *SYNOPSIS:*\n${data.synopsis ? data.synopsis.slice(0, 400) + '...' : 'Tidak ada sinopsis.'}\n\n`
            caption += `_Generated by Euphy System_`

            // Kirim poster dengan gaya Newsletter + AdReply
            await conn.sendMessage(m.chat, { 
                image: { url: data.images.jpg.large_image_url }, 
                caption: caption,
                contextInfo: {
                    forwardingScore: 999,
                    isForwarded: true,
                    forwardedNewsletterMessageInfo: {
                        newsletterJid: global.idch,
                        newsletterName: `Anime Database - ${global.namech}`
                    },
                    externalAdReply: {
                        title: `Info: ${data.title}`,
                        body: `Season: ${data.season || 'N/A'} ${data.year || ''}`,
                        thumbnailUrl: data.images.jpg.image_url,
                        sourceUrl: data.url,
                        mediaType: 1,
                        renderLargerThumbnail: true
                    }
                }
            }, { quoted: m });

            await conn.sendMessage(m.chat, { react: { text: 'âœ¨', key: m.key } });

        } catch (e) {
            console.error(e);
            m.reply('Terjadi kesalahan saat menghubungi database anime. âŒ');
            await conn.sendMessage(m.chat, { react: { text: 'âŒ', key: m.key } });
        }
    }
};
                
